[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
# ===== Basic Settings =====
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
max_connections = 50                      # Reduced for 2-core system (prevents overload)
max_allowed_packet = 256M                 # Prevent large packet errors (increased for larger attachments)
sql_mode = STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION

# ===== InnoDB Settings =====
# Server: 2 CPU cores, 7.25GB RAM
# Buffer pool: 1.5G (~20% of total RAM, leaving room for OS and other services)
innodb_buffer_pool_size = 1536M           # Main cache for data and indexes
innodb_log_file_size = 128M               # Redo log size; good balance between safety and performance
innodb_flush_log_at_trx_commit = 1        # 1 = safest; 2 for better performance (optional)
innodb_file_per_table = 1                 # Each table in a separate file (recommended)
innodb_flush_method = O_DIRECT            # Avoid double buffering
innodb_buffer_pool_instances = 1          # Single instance for 2-core system

# ===== Temporary Tables =====
tmp_table_size = 32M                      # Size for in-memory temp tables
max_heap_table_size = 32M                 # Match tmp_table_size for consistency

# ===== Thread and Query Handling =====
# Optimized for 2-core system
thread_cache_size = 8                     # Reduced for 2-core system (default: 8)
table_open_cache = 200                    # Reduced for smaller system (default: 2000, but 200 is safer)
query_cache_type = 0                      # Disabled (deprecated in MySQL 8)
query_cache_size = 0

# ===== Logging =====
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2                       # Log queries slower than 2 seconds

# ===== Networking =====
wait_timeout = 1800                       # Close idle connections after 30 minutes (for long-running tasks)
interactive_timeout = 1800                # 30 minutes for interactive connections
connect_timeout = 60                      # Connection timeout (60 seconds)
skip-name-resolve = 1                     # Avoid DNS lookup delays

# ===== Other =====
performance_schema = OFF                  # Save memory if performance_schema is not needed
